/*Q1: 查询" 01 "课程比" 02 "课程成绩高的学生的信息及课程分数*/

SELECT Student.*, t1.Score AS Score01, t2.Score AS Score02
FROM ((SELECT SID, SC.Score FROM SC WHERE CID = '01') AS t1 
INNER JOIN(SELECT SID, SC.Score FROM SC WHERE CID = '02') AS t2 
ON t1.SID = t2.SID AND t1.Score > t2.Score), Student
WHERE t1.SID = Student.SID

/*Q2: 查询同时存在"01"课程和"02"课程的情况*/

SELECT Student.*, t1.Score AS Score01, t2.Score AS Score02
FROM ((SELECT SID, SC.Score FROM SC WHERE CID = '01') AS t1 
INNER JOIN(SELECT SID, SC.Score FROM SC WHERE CID = '02') AS t2 
ON t1.SID = t2.SID), Student
WHERE t1.SID = Student.SID

/*Q3: 查询存在"01"课程但可能不存在"02"课程的情况（不存在时显示为 null）*/

SELECT Student.*, t1.Score AS Score01, t2.Score AS Score02
FROM ((SELECT SID, SC.Score FROM SC WHERE CID = '01') AS t1 
LEFT JOIN(SELECT SID, SC.Score FROM SC WHERE CID = '02') AS t2 
ON t1.SID = t2.SID), Student
WHERE t1.SID = Student.SID

/*Q4: 查询不存在" 01 "课程但存在" 02 "课程的情况*/

SELECT Student.*, SC.Score AS Score
FROM SC, Student
WHERE SC.SID not in (SELECT SID FROM SC WHERE SC.CID='01')
AND SC.CID='02'
AND SC.SID = Student.SID

/*Q5: 查询平均成绩大于等于 60 分的同学的学生编号，学生姓名和平均成绩*/

SELECT Student.*, AvgS
FROM Student INNER JOIN(
SELECT SID ,Round(Avg(Score), 1) AS AvgS
FROM SC 
GROUP BY SID
HAVING Avg(Score) >= 60) AS t1
ON Student.SID = t1.SID

/*Q6: 查询在 SC 表存在成绩的学生信息*/

SELECT Distinct Student.*
FROM (Student INNER JOIN SC ON Student.SID = SC.SID) AS t1
WHERE SC.Score is not NULL

/*Q7: 查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩(没成绩的显示为Null)*/

SELECT SID, SName, ClassSum, ScoreSum
FROM Student, (SELECT SID, Count(*) AS ClassSum, Sum(Score) AS ScoreSum 
FROM SC GROUP BY SID) AS t1
WHERE Student.SID = t1.SID

/*Q8: 查有成绩的学生信息*/

SELECT *
FROM Student
WHERE Exists(SELECT * FROM SC WHERE Student.SID = SC.SID)

/*Q9: 查询「李」姓老师的数量*/

SELECT Count(*)
FROM Teacher
WHERE TName Like '李%'

/*Q10: 查询学过「张三」老师授课的同学的信息*/

/*Solution1*/
SELECT *
FROM Student WHERE SID in 
(SELECT SID FROM SC WHERE CID in 
(SELECT CID FROM Course WHERE TID in 
(SELECT TID FROM Teacher WHERE Teacher.TName = '张三')))

/*Solution2*/
SELECT Student.*
FROM Student, Course, Teacher, SC
WHERE Teacher.TName = '张三'
AND Teacher.TID = Course.TID
AND Course.CID = SC.CID
AND SC.SID = Student.SID

/*Q11: 查询没有学全所有课程的同学的信息*/

/*Solution1*/
SELECT *
FROM Student
WHERE SID not in (SELECT SID FROM SC
GROUP BY SID
Having Count(CID) is not 
(SELECT DISTINCT Count(*) FROM Course))

/*Solution2*/
SELECT DISTINCT Student.*
FROM (SELECT Student.SID, Course.CID
FROM Student, Course) AS t1 LEFT JOIN 
(SELECT SC.SID, SC.CID FROM SC) AS t2 
ON t1.SID = t2.SID AND t1.CID = t2.CID, Student
WHERE t2.SID is NULL
AND t1.SID = Student.SID

/*Q12: 查询至少有一门课与学号为"01"的同学所学相同的同学的信息*/
/*Solution1*/
SELECT *
FROM Student
WHERE SID in (SELECT SID FROM SC
WHERE SC.CID in (SELECT CID FROM SC
WHERE SID = '01'))

/*Solution2*/
SELECT Student.*
FROM Student, SC
WHERE SC.CID in (SELECT CID FROM SC
WHERE SID = '01'))
AND Student.SID = SC.SID

/*Q13: 查询和"01"号的同学学习的课程完全相同的其他同学的信息*/



/*Q14: 查询没学过"张三"老师讲授的任一门课程的学生姓名*/

SELECT Student.SName
FROM Student
WHERE Student.SID not in
(SELECT SC.SID
FROM Course, Teacher, SC
WHERE Teacher.TName = '张三'
AND Course.TID = Teacher.TID
AND SC.CID = Course.CID)

/*Q15: 查询两门及以上不及格课程的同学的学号，姓名及其平均成绩*/
SELECT Student.SID, Student.SName, Round(Avg(SC.Score),1) AS AvgS
FROM Student, SC
WHERE SC.SID = Student.SID
AND SC.Score < 60
GROUP BY SC.SID
HAVING Count(*) >= 2

/*Q16: 检索"01"课程分数小于 60，按分数降序排列的学生信息*/

SELECT Student.*, SC.Score
FROM Student, SC
WHERE SC.CID = '01'
AND SC.Score < 60
AND Student.SID = SC.SID
ORDER BY 2 DESC

/*Q17: 按平均成绩从高到低显示所有学生的所有课程的成绩以及平均成绩*/
SELECT SC.SID, SC.CID, SC.Score, t1.AvgS
FROM SC LEFT JOIN (SELECT SC.SID, Avg(SC.Score) AS AvgS
FROM SC GROUP BY SC.SID) AS t1 ON SC.SID = t1.SID 
ORDER BY t1.AvgS DESC

/*Q18: 查询各科成绩最高分、最低分和平均分：
以如下形式显示：课程ID，课程name，最高分，最低分,平均分，及格率&中等率&优良率
（优秀率：及格为>=60，中等为：70-80，优良为：80-90，优秀为：>=90）
要求输出课程号和选修人数，查询结果按人数降序排列，若人数相同，按课程号升序排列*/


/*Q25: 查询每门课程被选修的学生数*/

SELECT Course.CName, Count(SC.Score) AS ClassSize
FROM Course, SC
WHERE Course.CID = SC.CID
GROUP BY CName
