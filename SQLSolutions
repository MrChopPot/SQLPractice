/*Q1: 查询" 01 "课程比" 02 "课程成绩高的学生的信息及课程分数*/

SELECT Student.*, t1.Score AS Score01, t2.Score AS Score02
FROM ((SELECT SID, SC.Score FROM SC WHERE CID = '01') AS t1 
INNER JOIN(SELECT SID, SC.Score FROM SC WHERE CID = '02') AS t2 
ON t1.SID = t2.SID AND t1.Score > t2.Score), Student
WHERE t1.SID = Student.SID

/*Q2: 查询同时存在"01"课程和"02"课程的情况*/

SELECT Student.*, t1.Score AS Score01, t2.Score AS Score02
FROM ((SELECT SID, SC.Score FROM SC WHERE CID = '01') AS t1 
INNER JOIN(SELECT SID, SC.Score FROM SC WHERE CID = '02') AS t2 
ON t1.SID = t2.SID), Student
WHERE t1.SID = Student.SID

/*Q3: 查询存在"01"课程但可能不存在"02"课程的情况（不存在时显示为 null）*/

SELECT Student.*, t1.Score AS Score01, t2.Score AS Score02
FROM ((SELECT SID, SC.Score FROM SC WHERE CID = '01') AS t1 
LEFT JOIN(SELECT SID, SC.Score FROM SC WHERE CID = '02') AS t2 
ON t1.SID = t2.SID), Student
WHERE t1.SID = Student.SID

/*Q4: 查询不存在" 01 "课程但存在" 02 "课程的情况*/

SELECT Student.*, SC.Score AS Score
FROM SC, Student
WHERE SC.SID not in (SELECT SID FROM SC WHERE SC.CID='01')
AND SC.CID='02'
AND SC.SID = Student.SID

/*Q5: 查询平均成绩大于等于 60 分的同学的学生编号，学生姓名和平均成绩*/

SELECT Student.*, AvgS
FROM Student INNER JOIN(
SELECT SID ,Round(Avg(Score), 1) AS AvgS
FROM SC 
GROUP BY SID
HAVING Avg(Score) >= 60) AS t1
ON Student.SID = t1.SID

/*Q6: 查询在 SC 表存在成绩的学生信息*/

SELECT Distinct Student.*
FROM (Student INNER JOIN SC ON Student.SID = SC.SID) AS t1
WHERE SC.Score is not NULL

/*Q7: 查询所有同学的学生编号、学生姓名、选课总数、所有课程的总成绩(没成绩的显示为Null)*/

SELECT SID, SName, ClassSum, ScoreSum
FROM Student, (SELECT SID, Count(*) AS ClassSum, Sum(Score) AS ScoreSum 
FROM SC GROUP BY SID) AS t1
WHERE Student.SID = t1.SID

/*Q8: 查有成绩的学生信息*/

SELECT *
FROM Student
WHERE Exists(SELECT * FROM SC WHERE Student.SID = SC.SID)

/*Q9: 查询「李」姓老师的数量*/

SELECT Count(*)
FROM Teacher
WHERE TName Like '李%'

/*Q10: 查询学过「张三」老师授课的同学的信息*/

/*Solution1*/
SELECT *
FROM Student WHERE SID in 
(SELECT SID FROM SC WHERE CID in 
(SELECT CID FROM Course WHERE TID in 
(SELECT TID FROM Teacher WHERE Teacher.TName = '张三')))

/*Solution2*/
SELECT Student.*
FROM Student, Course, Teacher, SC
WHERE Teacher.TName = '张三'
AND Teacher.TID = Course.TID
AND Course.CID = SC.CID
AND SC.SID = Student.SID

/*Q11: 查询没有学全所有课程的同学的信息*/

/*Solution1*/
SELECT *
FROM Student
WHERE SID not in (SELECT SID FROM SC
GROUP BY SID
Having Count(CID) is not 
(SELECT DISTINCT Count(*) FROM Course))

/*Solution2*/
SELECT DISTINCT Student.*
FROM (SELECT Student.SID, Course.CID
FROM Student, Course) AS t1 LEFT JOIN 
(SELECT SC.SID, SC.CID FROM SC) AS t2 
ON t1.SID = t2.SID AND t1.CID = t2.CID, Student
WHERE t2.SID is NULL
AND t1.SID = Student.SID

/*Q12: 查询至少有一门课与学号为"01"的同学所学相同的同学的信息*/
/*Solution1*/
SELECT *
FROM Student
WHERE SID in (SELECT SID FROM SC
WHERE SC.CID in (SELECT CID FROM SC
WHERE SID = '01'))

/*Solution2*/
SELECT Student.*
FROM Student, SC
WHERE SC.CID in (SELECT CID FROM SC
WHERE SID = '01'))
AND Student.SID = SC.SID
